name : 14 - Working with Artifacts

on : 
    workflow_dispatch :

jobs:
    test-build: 
        runs-on : ubuntu-latest
        defaults :
            run : 
              working-directory : ./04-using-actions/react-app
        steps : 
                - name : Checkout code
                  uses : actions/checkout@v4
                - name : Setup up node
                  uses : actions/setup-node@v3
                  with : 
                      node-version : '20.x'
                - name: Download cache dependencies
                  uses: actions/cache@v3
                  id: cache
                  with:
                    path : 04-using-actions/react-app/node_modules
                    key: deps-node-modules-${{ hashFiles('04-using-actions/react-app/package-lock.json') }}

                - name : Install dependencies
                  if : steps.cache.outputs.cache-hit != 'true'
                  run : npm ci
                - name : Run Unit tests
                  run : npm run test
                - name : Build the app
                  run : npm run build
                - name : Upload build files
                  uses : actions/upload-artifact@v4
                  with : 
                        name : react-app-build
                        path : ./04-using-actions/react-app/build

    deploy : 
          runs-on : ubuntu-latest
          needs: test-build
          steps: 
                - name : Download build files
                  uses : actions/download-artifact@v4
                  with : 
                        name : react-app-build
                        path : ./downloaded-artifact
                - name : List files
                  run : ls -la ./downloaded-artifact